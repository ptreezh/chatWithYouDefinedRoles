# 🎭 虚拟角色聊天室使用说明

## 📋 概述

虚拟角色聊天室是一个基于AI的智能对话系统，允许多个虚拟角色围绕不同话题进行讨论。每个角色都有独特的性格、背景和专业知识，能够根据话题内容智能评估兴趣度并参与讨论。

## 🚀 快速开始

### 1. 设置API密钥

#### 方法一：使用交互式设置向导（推荐）
```bash
node setup.js
```

#### 方法二：手动设置
编辑 `.env` 文件，添加您的API密钥：

```bash
# Z.ai API密钥（推荐）
ZAI_API_KEY=your-real-zai-api-key-here

# OpenAI API密钥（备用）
OPENAI_API_KEY=your-real-openai-api-key-here
```

### 2. 测试API连接
```bash
node test-api.js
```

### 3. 启动项目
```bash
npm run dev
```

### 4. 访问应用
打开浏览器访问：`http://localhost:3000`

## 🎭 角色系统

### 角色文件格式

#### 文本格式 (.txt)
```
# 角色定义：角色名称

## 基本信息
姓名：角色姓名
年龄：角色年龄
职业：角色职业

## 性格特点
- 性格特点1
- 性格特点2
- 性格特点3

## 背景故事
角色的背景故事描述...

## 专长领域
- 专业领域1
- 专业领域2
- 专业领域3

## 沟通风格
- 沟通方式描述
- 语言特点描述

## 价值观
- 价值观1
- 价值观2
- 价值观3
```

#### JSON格式 (.json)
```json
{
  "name": "角色姓名",
  "age": 角色年龄,
  "occupation": "角色职业",
  "personality": {
    "traits": ["性格特点1", "性格特点2"],
    "description": "性格描述"
  },
  "expertise": ["专业领域1", "专业领域2"],
  "system_prompt": "角色的系统提示词..."
}
```

#### Markdown格式 (.md)
```markdown
# 角色定义：角色名称

## 基本信息
- **姓名**：角色姓名
- **年龄**：角色年龄
- **职业**：角色职业

## 性格特点
- **特点1**：描述
- **特点2**：描述

## 背景故事
角色的背景故事...

## 专长领域
1. 专业领域1
2. 专业领域2

## 核心观点
- 观点1
- 观点2
```

### 预设角色

项目已提供以下示例角色：

1. **科技专家.txt** - AI研究员，专注于人工智能和机器学习
2. **心理咨询师.json** - 经验丰富的心理咨询师，擅长情绪管理
3. **创业导师.md** - 连续创业者，分享创业经验和建议
4. **小智角色定义.txt** - AI助手角色，乐于帮助解决问题
5. **小张角色定义.txt** - 科技博主，关注最新科技动态
6. **小李角色定义.txt** - 文艺青年，喜欢艺术和文学
7. **王总角色定义.json** - 商业精英，有丰富的管理经验

## 🎮 使用方法

### 上传角色文件

1. **通过界面上传**
   - 点击左侧边栏的"角色"标签页
   - 点击蓝色的"上传角色文件"按钮
   - 在文件选择对话框中选择角色文件
   - 支持按住Ctrl键多选（最多20个文件）
   - 点击"打开"开始上传

2. **支持的文件格式**
   - `.txt` - 纯文本格式
   - `.json` - JSON格式
   - `.md` - Markdown格式

3. **批量上传**
   - 一次最多可选择20个文件
   - 支持不同格式混合上传
   - 系统自动识别文件格式并解析

### 设置聊天主题

1. 点击左侧边栏的"设置"标签页
2. 在"聊天主题"输入框中输入主题
3. 点击"设置主题"按钮
4. 主题会影响角色对话题的兴趣度评估

### 开始聊天

1. 在底部输入框中输入消息
2. 按Enter键或点击"发送"按钮
3. 系统会自动选择合适的角色参与讨论

## 🔧 系统特性

### 强制参与机制

- **最低参与人数**：每轮至少有2个角色参与讨论
- **智能选择**：优先选择真正感兴趣的角色
- **补充机制**：如果感兴趣的角色不足，补充兴趣度最高的角色
- **透明显示**：显示每个角色的兴趣度评分和参与原因

### 兴趣度评估

- **评分标准**：
  - 0.0-0.2: 兴趣很低，不建议参与
  - 0.2-0.5: 中等兴趣，可以参与
  - 0.5-1.0: 高度兴趣，建议参与

- **评估因素**：
  - 话题与角色专业领域的相关性
  - 话题与角色性格的匹配度
  - 角色在类似话题上的历史参与度
  - 角色的参与积极性设定

### 独立记忆系统

- **个人记忆银行**：每个角色都有独立的记忆存储
- **关键记忆**：保存角色的重要观点和看法
- **对话历史**：记录角色参与过的对话
- **逻辑一致性**：确保角色发言不与之前的观点矛盾

### 多模型支持

- **Z.ai**：主要推荐的AI模型提供商
- **OpenAI**：备用的AI模型提供商
- **自定义API**：支持自定义AI服务接口

## 📱 界面说明

### 侧边栏（左侧）

#### 角色标签页
- **角色列表**：显示已上传的所有虚拟角色
- **上传按钮**：支持多文件上传（最多20个）
- **角色状态**：显示角色在线/离线状态、兴趣阈值和积极性

#### 设置标签页
- **聊天主题设置**：设置当前聊天室的主题
- **角色管理**：添加更多角色（次要入口）
- **系统状态**：显示当前系统状态和话题

### 主聊天区域（右侧）
- **聊天头部**：显示在线角色数量和当前主题
- **消息区域**：显示聊天消息，包含角色兴趣度评分
- **输入区域**：发送消息的输入框

## 🔍 故障排除

### API密钥问题

**错误信息**：`Incorrect API key provided`

**解决方案**：
1. 检查API密钥是否正确复制
2. 确认.env文件已保存
3. 重启开发服务器：`npm run dev`

**获取API密钥**：
- **Z.ai**：访问 [Z.ai 官网](https://z.ai) 注册获取
- **OpenAI**：访问 [OpenAI 官网](https://openai.com) 注册获取

### 角色无法回应

**可能原因**：
1. API密钥无效或过期
2. 网络连接问题
3. 角色文件格式错误
4. 服务器问题

**解决方案**：
1. 测试API连接：`node test-api.js`
2. 检查网络连接
3. 验证角色文件格式
4. 查看服务器日志：`tail -f dev.log`

### 文件上传失败

**可能原因**：
1. 文件格式不支持
2. 文件数量超过限制（最多20个）
3. 文件内容格式错误
4. 服务器存储空间不足

**解决方案**：
1. 确认文件格式为.txt、.json或.md
2. 减少文件数量
3. 检查文件内容格式
4. 清理服务器存储空间

## 🎨 高级功能

### 自定义角色创建

创建高质量角色文件的建议：

1. **明确的身份定位**：清晰定义角色的职业、年龄、背景
2. **丰富的性格特点**：描述角色的性格、习惯、偏好
3. **专业的知识领域**：列出角色的专业知识和技能
4. **独特的沟通风格**：定义角色的说话方式和语言特点
5. **一致的价值观**：明确角色的核心价值观和信念

### 话题引导技巧

1. **具体明确**：使用具体的话题而非笼统的问题
2. **结合角色**：选择与角色专业相关的话题
3. **循序渐进**：从简单话题开始，逐步深入
4. **多角度讨论**：鼓励角色从不同角度发表观点

### 记忆管理

系统会自动管理角色记忆，您也可以：

1. **观察记忆效果**：注意角色是否记住之前的对话
2. **调整话题**：基于角色的记忆调整讨论方向
3. **测试一致性**：验证角色观点的一致性

## 📞 技术支持

如果遇到问题，请：

1. **查看日志**：`tail -f dev.log`
2. **检查环境**：`node test-api.js`
3. **重新设置**：`node setup.js`
4. **重启服务**：`npm run dev`

## 🎉 享受体验！

虚拟角色聊天室为您提供了一个独特的AI对话体验。通过精心设计的角色系统和智能的话题评估，您可以观察不同性格的AI角色如何围绕各种话题展开讨论，享受AI技术带来的乐趣！

---

**提示**：为了获得最佳体验，建议您：
- 使用有效的API密钥
- 上传多样化的角色文件
- 选择有趣的话题进行讨论
- 观察角色的互动和记忆效果