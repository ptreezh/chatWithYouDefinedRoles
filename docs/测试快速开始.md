# 🚀 本地模型自动化测试 - 快速开始指南

## 📋 测试系统概览

我们已经创建了一个完整的基于本地Ollama模型的自动化测试系统，包含以下组件：

### 📁 测试脚本文件
- `scripts/basic-test.js` - 基本功能验证
- `scripts/e2e-test.js` - 端到端聊天流程测试
- `scripts/performance-test.js` - 性能和负载测试
- `scripts/test-runner.js` - 综合测试运行器
- `scripts/test-api.js` - API连接测试

### 📋 配置文件
- `test-config.json` - 测试配置
- `.env` - 环境变量配置

### 📊 测试报告
- `test-reports/` - 自动生成的测试报告目录

## 🎯 快速测试流程

### 第一步：环境检查

```bash
# 1. 检查Node.js版本
node --version

# 2. 检查Ollama服务
curl http://localhost:11434/api/tags

# 3. 启动开发服务器（如果未运行）
npm run dev
```

### 第二步：基本验证

```bash
# 运行基本功能测试
npm run test:basic
```

这个命令会检查：
- ✅ Ollama服务连接
- ✅ 系统健康状态
- ✅ API端点响应
- ✅ 配置文件状态

### 第三步：选择测试类型

根据需要选择相应的测试：

```bash
# 健康检查
npm run test:health

# API连接测试
npm run test:api

# 端到端聊天测试
npm run test:e2e

# 性能测试
npm run test:performance

# 快速测试（健康 + API）
npm run test:quick

# 完整测试套件
npm run test:all
```

## 🔧 详细测试说明

### 1. 基本测试 (`test:basic`)

**用途**: 验证系统基本功能是否正常

**检查项目**:
- Ollama服务是否运行
- 开发服务器是否响应
- 基本API端点是否可访问

**期望结果**: 所有检查通过，显示成功消息

### 2. 端到端测试 (`test:e2e`)

**用途**: 测试完整的聊天流程

**测试流程**:
1. 创建测试主题
2. 创建测试角色
3. 初始化聊天室
4. 发送多条测试消息
5. 验证回复生成
6. 测试记忆系统
7. 清理测试数据

**期望结果**: 聊天流程完整执行，生成测试报告

### 3. 性能测试 (`test:performance`)

**用途**: 测试系统在高负载下的表现

**测试内容**:
- 单请求响应时间
- 并发用户处理
- 压力测试（持续负载）
- 不同Ollama模型对比

**期望结果**: 响应时间在可接受范围内，系统稳定运行

### 4. 综合测试 (`test:all`)

**用途**: 运行完整的测试套件

**包含内容**:
- 环境健康检查
- API连接测试
- 数据库操作测试
- 端到端功能测试
- 性能基准测试

## 📊 测试报告解读

### 报告位置
测试报告自动保存在 `test-reports/` 目录：
- `e2e-test-*.json` - 端到端测试详情
- `performance-test-*.json` - 性能测试数据
- `test-summary-*.json` - 综合测试总结

### 关键指标

#### 成功率
```
成功率 > 80%: 系统状态良好
成功率 60-80%: 部分功能异常
成功率 < 60%: 需要立即修复
```

#### 响应时间
```
单请求 < 3秒: 性能优秀
单请求 3-5秒: 性能可接受
单请求 > 5秒: 需要优化
```

#### 吞吐量
```
> 10 req/s: 性能优秀
5-10 req/s: 性能良好
< 5 req/s: 需要优化
```

## ⚠️ 常见问题解决

### 1. Ollama连接失败

**问题**: 测试显示Ollama服务不可用

**解决方案**:
```bash
# 检查Ollama服务状态
curl http://localhost:11434/api/tags

# 如果服务未运行，启动Ollama
ollama serve

# 检查Ollama安装的模型
ollama list
```

### 2. 服务器连接失败

**问题**: 无法连接到localhost:3000

**解决方案**:
```bash
# 检查端口占用
netstat -an | grep 3000

# 启动开发服务器
npm run dev

# 检查服务器日志
tail -f dev.log
```

### 3. 测试超时

**问题**: 测试脚本显示超时错误

**解决方案**:
```bash
# 增加超时时间
export TEST_TIMEOUT=60000

# 检查系统资源
htop

# 重新运行测试
npm run test:basic
```

### 4. 数据库错误

**问题**: 数据库相关测试失败

**解决方案**:
```bash
# 检查数据库文件
ls -la db/custom.db

# 重新生成Prisma客户端
npm run db:generate

# 重置数据库
npm run db:reset
```

## 🎯 测试最佳实践

### 1. 测试前准备
- 确保Ollama服务正常运行
- 准备至少一个测试模型（如llama2）
- 清理之前的测试数据
- 确保有足够的系统资源

### 2. 测试执行
- 按顺序执行：基本测试 → 功能测试 → 性能测试
- 观察测试过程中的日志输出
- 记录异常情况以便排查

### 3. 结果分析
- 查看生成的测试报告
- 分析失败原因
- 对比历史测试结果
- 制定优化计划

### 4. 定期测试
- 代码变更后运行基本测试
- 发布前运行完整测试套件
- 定期性能测试监控趋势

## 📞 获取帮助

如果遇到问题：

1. **查看日志**: `tail -f dev.log`
2. **检查文档**: `docs/测试系统说明.md`
3. **运行诊断**: `npm run test:basic`
4. **查看配置**: `cat test-config.json`

---

**提示**: 本测试系统专为本地Ollama模型优化，确保在运行测试前已正确配置本地环境。