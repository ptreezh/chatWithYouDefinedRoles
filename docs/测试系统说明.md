# ğŸ§ª æœ¬åœ°æ¨¡å‹è‡ªåŠ¨åŒ–æµ‹è¯•ç³»ç»Ÿ

## ğŸ“‹ æµ‹è¯•ç³»ç»Ÿæ¦‚è¿°

æœ¬é¡¹ç›®æä¾›äº†å®Œæ•´çš„åŸºäºæœ¬åœ°Ollamaæ¨¡å‹çš„ç«¯åˆ°ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•ç³»ç»Ÿï¼ŒåŒ…æ‹¬ï¼š

- **å¥åº·æ£€æŸ¥**: ç³»ç»ŸçŠ¶æ€å’ŒæœåŠ¡å¯ç”¨æ€§æ£€æŸ¥
- **APIæµ‹è¯•**: å„ä¸ªAPIç«¯ç‚¹çš„è¿æ¥å’ŒåŠŸèƒ½æµ‹è¯•
- **ç«¯åˆ°ç«¯æµ‹è¯•**: å®Œæ•´çš„èŠå¤©æµç¨‹æµ‹è¯•
- **æ€§èƒ½æµ‹è¯•**: å¹¶å‘å’Œå‹åŠ›æµ‹è¯•
- **æ•°æ®åº“æµ‹è¯•**: æ•°æ®å­˜å‚¨å’Œæ£€ç´¢æµ‹è¯•
- **å†…å­˜ç³»ç»Ÿæµ‹è¯•**: è§’è‰²è®°å¿†å’Œå¯¹è¯å†å²æµ‹è¯•

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿ä»¥ä¸‹æœåŠ¡å·²å®‰è£…å¹¶è¿è¡Œï¼š

```bash
# æ£€æŸ¥Node.jsç‰ˆæœ¬
node --version  # éœ€è¦ >= 18.0.0

# æ£€æŸ¥OllamaæœåŠ¡
curl http://localhost:11434/api/tags

# å¯åŠ¨é¡¹ç›®æœåŠ¡å™¨
npm run dev
```

### 2. åŸºæœ¬æµ‹è¯•å‘½ä»¤

```bash
# å¥åº·æ£€æŸ¥
npm run test:health

# APIè¿æ¥æµ‹è¯•
npm run test:api

# ç«¯åˆ°ç«¯æµ‹è¯•
npm run test:e2e

# æ€§èƒ½æµ‹è¯•
npm run test:performance

# å¿«é€Ÿæµ‹è¯•ï¼ˆå¥åº·æ£€æŸ¥ + APIæµ‹è¯•ï¼‰
npm run test:quick

# å®Œæ•´æµ‹è¯•ï¼ˆæ‰€æœ‰æµ‹è¯•ï¼‰
npm run test:all

# å…¨é¢æµ‹è¯•ï¼ˆåŒ…å«æ€§èƒ½å’Œæ•°æ®åº“ï¼‰
npm run test:full
```

### 3. ä½¿ç”¨æµ‹è¯•è¿è¡Œå™¨

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
node scripts/test-runner.js

# è¿è¡Œç‰¹å®šæµ‹è¯•
node scripts/test-runner.js --e2e --performance

# æŸ¥çœ‹å¸®åŠ©
node scripts/test-runner.js --help
```

## ğŸ“Š æµ‹è¯•ç±»å‹è¯¦è§£

### 1. å¥åº·æ£€æŸ¥æµ‹è¯• (`test:health`)

æ£€æŸ¥ç³»ç»Ÿå„ç»„ä»¶çš„å¥åº·çŠ¶æ€ï¼š
- âœ… æ•°æ®åº“è¿æ¥
- âœ… OllamaæœåŠ¡çŠ¶æ€
- âœ… APIé…ç½®çŠ¶æ€
- âœ… å­˜å‚¨ç›®å½•è®¿é—®æ€§

**è¾“å‡ºç¤ºä¾‹ï¼š**
```json
{
  "status": "healthy",
  "database": "connected",
  "ollama": {
    "status": "connected",
    "models": 3,
    "available": ["llama2", "mistral", "codellama"]
  },
  "stats": {
    "characters": 5,
    "messages": 42,
    "themes": 3
  }
}
```

### 2. APIè¿æ¥æµ‹è¯• (`test:api`)

æµ‹è¯•æ‰€æœ‰APIç«¯ç‚¹çš„è¿æ¥æ€§ï¼š
- `/api/health` - å¥åº·æ£€æŸ¥
- `/api/config` - é…ç½®ç®¡ç†
- `/api/characters` - è§’è‰²ç®¡ç†
- `/api/themes` - ä¸»é¢˜ç®¡ç†

### 3. ç«¯åˆ°ç«¯æµ‹è¯• (`test:e2e`)

å®Œæ•´çš„èŠå¤©æµç¨‹æµ‹è¯•ï¼š
1. åˆ›å»ºæµ‹è¯•ä¸»é¢˜
2. åˆ›å»ºæµ‹è¯•è§’è‰²
3. åˆå§‹åŒ–èŠå¤©å®¤
4. å‘é€æµ‹è¯•æ¶ˆæ¯
5. éªŒè¯å›å¤ç”Ÿæˆ
6. æµ‹è¯•è®°å¿†ç³»ç»Ÿ
7. æ¸…ç†æµ‹è¯•æ•°æ®

**æµ‹è¯•æµç¨‹ï¼š**
```
åˆ›å»ºä¸»é¢˜ â†’ åˆ›å»ºè§’è‰² â†’ åˆå§‹åŒ–èŠå¤© â†’ å‘é€æ¶ˆæ¯ â†’ éªŒè¯å›å¤ â†’ æµ‹è¯•è®°å¿† â†’ æ¸…ç†æ•°æ®
```

### 4. æ€§èƒ½æµ‹è¯• (`test:performance`)

ç³»ç»Ÿæ€§èƒ½å’Œè´Ÿè½½æµ‹è¯•ï¼š
- **å•è¯·æ±‚æ€§èƒ½**: å“åº”æ—¶é—´å’Œååé‡
- **å¹¶å‘æµ‹è¯•**: å¤šç”¨æˆ·åŒæ—¶è®¿é—®
- **å‹åŠ›æµ‹è¯•**: æŒç»­é«˜è´Ÿè½½æµ‹è¯•
- **æ¨¡å‹å¯¹æ¯”**: ä¸åŒOllamaæ¨¡å‹æ€§èƒ½å¯¹æ¯”

**æ€§èƒ½æŒ‡æ ‡ï¼š**
- å“åº”æ—¶é—´ (ms)
- ååé‡ (requests/second)
- æˆåŠŸç‡ (%)
- å¹¶å‘å¤„ç†èƒ½åŠ›

### 5. æ•°æ®åº“æµ‹è¯• (`test:database`)

æ•°æ®åº“æ“ä½œæµ‹è¯•ï¼š
- è¿æ¥ç¨³å®šæ€§
- CRUDæ“ä½œ
- æŸ¥è¯¢æ€§èƒ½
- æ•°æ®å®Œæ•´æ€§

### 6. å†…å­˜ç³»ç»Ÿæµ‹è¯• (`test:memory`)

è§’è‰²è®°å¿†ç³»ç»Ÿæµ‹è¯•ï¼š
- è®°å¿†é“¶è¡Œåˆ›å»º
- å¯¹è¯å†å²å­˜å‚¨
- å…³é”®è®°å¿†æå–
- è®°å¿†æ£€ç´¢æ€§èƒ½

## âš™ï¸ æµ‹è¯•é…ç½®

### æµ‹è¯•é…ç½®æ–‡ä»¶ (`test-config.json`)

```json
{
  "services": {
    "ollama": {
      "baseUrl": "http://localhost:11434",
      "defaultModel": "llama2",
      "timeout": 30000
    }
  },
  "tests": {
    "e2e": {
      "enabled": true,
      "testMessages": ["æµ‹è¯•æ¶ˆæ¯1", "æµ‹è¯•æ¶ˆæ¯2"],
      "maxResponseTime": 30000
    },
    "performance": {
      "concurrentUsers": [1, 5, 10, 20],
      "testDuration": 30000
    }
  }
}
```

### ç¯å¢ƒå˜é‡

```bash
# æ•°æ®åº“é…ç½®
DATABASE_URL="file:./db/custom.db"

# Ollamaé…ç½®
OLLAMA_BASE_URL="http://localhost:11434"
OLLAMA_MODEL="llama2"

# æµ‹è¯•é…ç½®
TEST_TIMEOUT=30000
TEST_MAX_RETRIES=3
```

## ğŸ“ˆ æµ‹è¯•æŠ¥å‘Š

### æŠ¥å‘Šç”Ÿæˆä½ç½®

æ‰€æœ‰æµ‹è¯•æŠ¥å‘Šä¼šè‡ªåŠ¨ä¿å­˜åˆ° `test-reports/` ç›®å½•ï¼š
- `e2e-test-*.json` - ç«¯åˆ°ç«¯æµ‹è¯•æŠ¥å‘Š
- `performance-test-*.json` - æ€§èƒ½æµ‹è¯•æŠ¥å‘Š
- `test-summary-*.json` - ç»¼åˆæµ‹è¯•æ€»ç»“

### æŠ¥å‘Šå†…å®¹ç¤ºä¾‹

```json
{
  "timestamp": "2024-01-20T10:30:00.000Z",
  "summary": {
    "totalTests": 6,
    "passedTests": 5,
    "failedTests": 1,
    "successRate": "83.3%"
  },
  "tests": [
    {
      "name": "æœåŠ¡å™¨å¥åº·æ£€æŸ¥",
      "success": true
    },
    {
      "name": "ç«¯åˆ°ç«¯æµ‹è¯•",
      "success": true,
      "report": {
        "chatResults": [
          {
            "message": "ä½ å¥½ï¼Œæˆ‘æƒ³äº†è§£AIæµ‹è¯•",
            "responseTime": 2450,
            "success": true
          }
        ]
      }
    }
  ]
}
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **Ollamaè¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥OllamaæœåŠ¡çŠ¶æ€
   curl http://localhost:11434/api/tags
   
   # é‡å¯OllamaæœåŠ¡
   sudo systemctl restart ollama
   ```

2. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶
   ls -la db/custom.db
   
   # é‡æ–°ç”ŸæˆPrismaå®¢æˆ·ç«¯
   npm run db:generate
   ```

3. **æœåŠ¡å™¨å¯åŠ¨å¤±è´¥**
   ```bash
   # æ£€æŸ¥ç«¯å£å ç”¨
   netstat -an | grep 3000
   
   # æ¸…ç†å¹¶é‡æ–°å®‰è£…ä¾èµ–
   rm -rf node_modules package-lock.json
   npm install
   ```

4. **æµ‹è¯•è¶…æ—¶**
   ```bash
   # å¢åŠ æµ‹è¯•è¶…æ—¶æ—¶é—´
   export TEST_TIMEOUT=60000
   
   # æ£€æŸ¥ç³»ç»Ÿèµ„æº
   htop
   ```

### è°ƒè¯•æ¨¡å¼

å¯ç”¨è¯¦ç»†æ—¥å¿—è¾“å‡ºï¼š
```bash
# å¯ç”¨è°ƒè¯•æ¨¡å¼
DEBUG=* node scripts/test-runner.js

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
tail -f dev.log
```

## ğŸ¯ æœ€ä½³å®è·µ

### 1. æµ‹è¯•ç¯å¢ƒå‡†å¤‡
- ç¡®ä¿OllamaæœåŠ¡æ­£å¸¸è¿è¡Œ
- å‡†å¤‡æµ‹è¯•æ¨¡å‹ï¼ˆllama2, mistralç­‰ï¼‰
- æ¸…ç†æµ‹è¯•æ•°æ®é¿å…å¹²æ‰°

### 2. å®šæœŸæµ‹è¯•
- æ¯æ¬¡ä»£ç å˜æ›´åè¿è¡Œå¿«é€Ÿæµ‹è¯•
- å‘å¸ƒå‰è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
- å®šæœŸæ€§èƒ½æµ‹è¯•ç›‘æ§ç³»ç»Ÿå¥åº·

### 3. æ€§èƒ½ç›‘æ§
- ç›‘æ§å“åº”æ—¶é—´è¶‹åŠ¿
- è·Ÿè¸ªæˆåŠŸç‡å˜åŒ–
- è®°å½•ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ

### 4. æµ‹è¯•æ•°æ®ç®¡ç†
- å®šæœŸæ¸…ç†æµ‹è¯•æŠ¥å‘Š
- å¤‡ä»½é‡è¦çš„æµ‹è¯•ç»“æœ
- åˆ†ææµ‹è¯•è¶‹åŠ¿å’Œæ¨¡å¼

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [é¡¹ç›®å‡çº§æ€»ç»“](./docs/é¡¹ç›®å‡çº§æ€»ç»“.md)
- [è§’è‰²ç®¡ç†ç³»ç»Ÿ](./docs/è§’è‰²ç®¡ç†ç³»ç»Ÿ.md)
- [ç›®å½•ç»“æ„è¯´æ˜](./docs/ç›®å½•ç»“æ„è¯´æ˜.md)
- [CRUSHå¼€å‘æŒ‡å—](./CRUSH.md)

---

**æç¤º**: æœ¬æµ‹è¯•ç³»ç»Ÿä¸“ä¸ºæœ¬åœ°Ollamaæ¨¡å‹ä¼˜åŒ–ï¼Œç¡®ä¿åœ¨è¿è¡Œæµ‹è¯•å‰å·²æ­£ç¡®é…ç½®æœ¬åœ°ç¯å¢ƒã€‚