# 虚拟角色聊天室使用指南

## 界面介绍

### 1. 侧边栏（左侧）
现在侧边栏默认显示，包含以下功能：

#### 角色标签页
- **角色列表**：显示已上传的所有虚拟角色
- **上传角色文件按钮**：支持一次选择多个文件（最多20个）
- **角色状态**：显示角色在线/离线状态、兴趣阈值和积极性

#### 设置标签页
- **聊天主题设置**：设置当前聊天室的主题
- **角色管理**：添加更多角色（次要入口，也支持多文件上传）
- **系统状态**：显示当前系统状态和话题

### 2. 主聊天区域（右侧）
- **聊天头部**：显示在线角色数量和当前主题
- **消息区域**：显示聊天消息，包含角色兴趣度评分
- **输入区域**：发送消息的输入框

## 使用步骤

### 步骤1：上传角色文件（支持多文件上传）
1. 点击左侧边栏的"角色"标签页
2. 点击蓝色的"上传角色文件"按钮
3. 在文件选择对话框中，可以按住Ctrl键选择多个文件（最多20个）
4. 支持的角色定义文件格式：.txt, .json, .md
5. 文件内容将自动解析为角色提示词
6. 上传成功后会显示"成功上传X个角色！"的提示

### 步骤2：设置聊天主题（可选）
1. 点击左侧边栏的"设置"标签页
2. 在"聊天主题"输入框中输入主题
3. 点击"设置主题"按钮

### 步骤3：开始聊天（强制参与机制）
1. 在底部输入框中输入消息
2. 按Enter键或点击"发送"按钮
3. 系统会强制至少2个角色参与讨论，避免尴尬的沉默
4. 角色会显示兴趣度评分和参与原因

## 角色文件格式示例

### 文本格式 (.txt)
```
# 角色定义：小明

## 基本信息
姓名：小明
年龄：25岁
职业：软件工程师

## 性格特点
- 开朗外向，喜欢与人交流
- 对技术充满热情，特别是人工智能和编程
- 乐于助人，喜欢分享知识

## 背景故事
小明是一名有5年经验的软件工程师...
```

### JSON格式 (.json)
```json
{
  "name": "小红",
  "age": 28,
  "occupation": "产品经理",
  "personality": {
    "traits": ["细心谨慎", "善于沟通", "逻辑思维强"],
    "description": "小红是一名经验丰富的产品经理..."
  },
  "system_prompt": "你是一名经验丰富的产品经理小红..."
}
```

## 新功能特点

### 🚀 多文件上传支持
- **批量上传**：一次可上传最多20个角色文件
- **多格式支持**：同时支持.txt、.json、.md格式
- **智能解析**：自动识别文件格式并解析角色信息
- **进度反馈**：显示上传成功的角色数量

### 🎯 强制参与机制
- **避免尴尬**：强制每一轮至少有2个角色参与讨论
- **智能选择**：优先选择真正感兴趣的角色，不足时补充兴趣度最高的
- **透明显示**：显示每个角色的兴趣度评分和参与原因
- **降低门槛**：调整了兴趣度评估标准，让角色更容易参与

### 📊 兴趣度评估优化
- **新评估标准**：
  - 0.0-0.2: 兴趣很低，不建议参与
  - 0.2-0.5: 中等兴趣，可以参与
  - 0.5-1.0: 高度兴趣，建议参与
- **降低门槛**：相比之前的标准，现在角色更容易参与讨论
- **强制参与**：即使兴趣度不高，系统也会选择最合适的角色参与

### 智能参与机制
- 每个角色都有独立的兴趣阈值
- 角色会根据话题内容评估兴趣度
- 系统确保每轮至少有2个角色参与
- 优先选择真正感兴趣的角色，不足时补充兴趣度最高的

### 独立记忆系统
- 每个角色都有独立的Memory Bank
- 角色会记住自己的发言和上下文
- 确保角色发言的逻辑一致性

### 多模型支持
- 支持多种AI模型配置
- 每个角色可以独立选择使用的模型
- 支持Z.ai、OpenAI、Anthropic等模型

## 移动端使用
- 点击左上角的机器人图标可以显示/隐藏侧边栏
- 在移动设备上，侧边栏可以通过按钮切换显示状态

## 示例角色文件
项目提供了以下示例角色文件，方便测试：
- `小智角色定义.txt` - AI助手角色
- `小张角色定义.txt` - 科技博主角色
- `小李角色定义.txt` - 文艺青年角色
- `王总角色定义.json` - 商业精英角色

## 常见问题

### Q: 为什么现在角色都会参与讨论了？
A: 为了避免尴尬的沉默，系统现在强制每一轮至少有2个角色参与。优先选择真正感兴趣的角色，如果感兴趣的角色不足2个，会补充兴趣度最高的角色参与。

### Q: 如何一次上传多个角色？
A: 在文件选择对话框中，按住Ctrl键（Windows）或Command键（Mac）可以同时选择多个文件，最多支持20个文件同时上传。

### Q: 兴趣度评估标准是什么？
A: 新的评估标准为：0.0-0.2（兴趣很低）、0.2-0.5（中等兴趣）、0.5-1.0（高度兴趣）。相比之前的标准，现在角色更容易参与讨论。

### Q: 角色的参与原因显示什么？
A: 系统会显示每个角色参与讨论的原因，如果是真正感兴趣会显示具体原因，如果是强制参与会显示"强制参与以保持对话活跃"。

### Q: 支持哪些文件格式？
A: 支持 .txt, .json, .md 格式。可以一次选择多个不同格式的文件同时上传。

### Q: 如何设置聊天主题？
A: 在"设置"标签页中输入主题并点击"设置主题"按钮。