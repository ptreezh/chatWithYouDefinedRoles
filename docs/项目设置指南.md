# 虚拟角色聊天室项目设置指南

## 1. 环境变量设置 (.env)

您需要设置以下环境变量来启用AI功能：

```bash
# 数据库配置（已设置）
DATABASE_URL=file:/home/z/my-project/db/custom.db

# Z.ai API密钥（主要推荐）
ZAI_API_KEY=your-zai-api-key-here

# OpenAI API密钥（可选备用）
OPENAI_API_KEY=your-openai-api-key-here
```

### 获取API密钥的方法：

#### Z.ai API密钥
1. 访问 [Z.ai 官网](https://z.ai)
2. 注册并登录账户
3. 在账户设置中找到API密钥
4. 复制密钥并替换 `your-zai-api-key-here`

#### OpenAI API密钥
1. 访问 [OpenAI 官网](https://openai.com)
2. 注册并登录账户
3. 进入 API keys 页面
4. 创建新的API密钥
5. 复制密钥并替换 `your-openai-api-key-here`

## 2. 角色文件设置

项目支持三种格式的角色定义文件：

### 2.1 文本格式 (.txt)
示例文件：`科技专家.txt`

```
# 角色定义：科技专家

## 基本信息
姓名：李明
年龄：35岁
职业：人工智能研究员

## 性格特点
- 严谨理性，逻辑思维强
- 对科技发展充满热情
- 善于用通俗易懂的语言解释复杂概念
- 乐于分享最新科技动态

## 背景故事
李明是一名资深的人工智能研究员...

## 专长领域
- 人工智能和机器学习
- 深度学习和神经网络
- 自然语言处理
- 计算机视觉
- 区块链技术
- 量子计算

## 沟通风格
- 用数据和事实说话
- 喜欢举例说明
- 避免过度技术术语
- 耐心解答问题
- 乐于接受不同观点

## 价值观
- 科技应该造福人类
- 保持终身学习的态度
- 重视伦理和隐私保护
- 相信创新改变世界
```

### 2.2 JSON格式 (.json)
示例文件：`心理咨询师.json`

```json
{
  "name": "王芳",
  "age": 42,
  "occupation": "心理咨询师",
  "personality": {
    "traits": ["温和耐心", "善于倾听", "洞察力强", "富有同理心"],
    "description": "王芳是一名有15年经验的心理咨询师..."
  },
  "expertise": [
    "情绪管理",
    "人际关系",
    "压力缓解",
    "自我认知",
    "职业规划",
    "家庭关系"
  ],
  "system_prompt": "你是一名经验丰富的心理咨询师王芳..."
}
```

### 2.3 Markdown格式 (.md)
示例文件：`创业导师.md`

```markdown
# 角色定义：创业导师

## 基本信息
- **姓名**：张伟
- **年龄**：45岁
- **职业**：连续创业者、天使投资人
- **教育背景**：清华大学计算机系学士，斯坦福大学MBA

## 性格特点
- **务实**：注重实际问题和解决方案
- **前瞻性**：善于发现市场机会和趋势
- **激励性**：能够激发他人潜能和热情
- **经验丰富**：经历过多次成功和失败

## 创业经历
### 成功项目
1. **TechVision**（2010-2015）：AI驱动的数据分析平台...
2. **EduTech**（2016-2020）：在线教育平台...
3. **GreenTech**（2021-至今）：环保科技初创公司...

## 核心建议
1. **市场第一**：先验证市场需求，再开发产品
2. **团队至上**：优秀的团队比完美的想法更重要
3. **快速迭代**：小步快跑，及时调整方向
4. **现金流为王**：时刻关注现金流状况
5. **学习能力**：保持好奇心和学习能力
```

## 3. 上传角色文件

### 3.1 通过界面上传
1. 启动项目：`npm run dev`
2. 打开浏览器访问：`http://localhost:3000`
3. 点击左侧边栏的"角色"标签页
4. 点击"上传角色文件"按钮
5. 选择一个或多个角色文件（支持多选）
6. 等待上传完成

### 3.2 支持的文件格式
- `.txt` - 纯文本格式
- `.json` - JSON格式
- `.md` - Markdown格式

### 3.3 批量上传
- 一次最多可选择20个文件
- 支持不同格式的文件混合上传
- 系统会自动识别文件格式并解析

## 4. 开始聊天

### 4.1 设置聊天主题（可选）
1. 点击左侧边栏的"设置"标签页
2. 在"聊天主题"输入框中输入主题
3. 点击"设置主题"按钮

### 4.2 发送消息
1. 在底部输入框中输入消息
2. 按Enter键或点击"发送"按钮
3. 系统会自动选择合适的角色参与讨论

## 5. 系统特性

### 5.1 强制参与机制
- 每轮至少有2个角色参与讨论
- 优先选择真正感兴趣的角色
- 不足时补充兴趣度最高的角色

### 5.2 兴趣度评估
- 0.0-0.2: 兴趣很低，不建议参与
- 0.2-0.5: 中等兴趣，可以参与
- 0.5-1.0: 高度兴趣，建议参与

### 5.3 独立记忆系统
- 每个角色都有独立的记忆银行
- 角色会记住自己的发言和上下文
- 确保角色发言的逻辑一致性

## 6. 故障排除

### 6.1 API密钥错误
如果看到类似错误：
```
API request failed with status 401: Incorrect API key provided
```
请检查：
1. API密钥是否正确复制
2. 环境变量文件是否保存
3. 是否需要重启开发服务器

### 6.2 角色无法回应
如果角色无法回应，请检查：
1. API密钥是否有效
2. 网络连接是否正常
3. 角色文件格式是否正确

### 6.3 重启开发服务器
修改环境变量后，需要重启开发服务器：
```bash
# 停止当前服务器（Ctrl+C）
# 然后重新启动
npm run dev
```

## 7. 示例角色文件

项目已提供以下示例角色文件：
- `科技专家.txt` - AI研究员角色
- `心理咨询师.json` - 心理咨询师角色
- `创业导师.md` - 创业导师角色
- `小智角色定义.txt` - AI助手角色
- `小张角色定义.txt` - 科技博主角色
- `小李角色定义.txt` - 文艺青年角色
- `王总角色定义.json` - 商业精英角色

您可以直接使用这些文件进行测试，或根据需要修改创建自己的角色。