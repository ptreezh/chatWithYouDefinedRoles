# 🎭 虚拟角色聊天室 - 用户使用指南

## 📋 系统概述

虚拟角色聊天室是一个功能完整的AI对话系统，支持多角色智能讨论、API配置管理、角色文件管理等核心功能。每个用户都可以独立配置自己的API密钥和角色文件。

## 🚀 快速开始

### 1. 启动系统
```bash
npm run dev
```
访问：`http://localhost:3000`

### 2. 配置API密钥
系统默认以演示模式启动，您可以：
- **使用演示模式**：直接体验所有功能（推荐新手）
- **配置真实API**：设置自己的API密钥获得更好的体验

### 3. 上传角色文件
上传您创建的角色文件或使用系统提供的示例角色

### 4. 开始聊天
输入消息，观察AI角色们的智能讨论

## 🔧 API配置管理

### API配置界面
**位置**：侧边栏 → 设置 → API配置

### 支持的AI服务
1. **Z.ai API**（推荐）
   - 访问 [Z.ai官网](https://z.ai) 获取API密钥
   - 主要推荐的服务，效果最佳

2. **OpenAI API**（备用）
   - 访问 [OpenAI控制台](https://platform.openai.com/api-keys) 获取API密钥
   - 可作为备用服务

### 配置步骤
1. 点击"配置API密钥"按钮
2. 选择要配置的API服务（Z.ai或OpenAI）
3. 输入您的API密钥
4. 点击"测试连接"验证密钥有效性
5. 点击"保存配置"

### 配置特点
- **实时测试**：支持连接测试，确保密钥有效
- **双重支持**：可同时配置多个API服务
- **智能切换**：主服务失败时自动切换到备用服务
- **本地存储**：配置保存在浏览器本地存储中

## 🎭 角色管理系统

### 角色管理界面
**位置**：侧边栏 → 管理

### 角色文件格式

#### 1. 文本格式 (.txt)
```
# 角色定义：角色名称

## 基本信息
姓名：角色姓名
年龄：角色年龄
职业：角色职业

## 性格特点
- 性格特点1
- 性格特点2
- 性格特点3

## 背景故事
角色的背景故事描述...

## 专长领域
- 专业领域1
- 专业领域2
- 专业领域3

## 沟通风格
- 沟通方式描述
- 语言特点描述

## 价值观
- 价值观1
- 价值观2
- 价值观3
```

#### 2. JSON格式 (.json)
```json
{
  "name": "角色姓名",
  "age": 角色年龄,
  "occupation": "角色职业",
  "personality": {
    "traits": ["性格特点1", "性格特点2"],
    "description": "性格描述"
  },
  "expertise": ["专业领域1", "专业领域2"],
  "system_prompt": "角色的系统提示词..."
}
```

#### 3. Markdown格式 (.md)
```markdown
# 角色定义：角色名称

## 基本信息
- **姓名**：角色姓名
- **年龄**：角色年龄
- **职业**：角色职业

## 性格特点
- **特点1**：描述
- **特点2**：描述

## 背景故事
角色的背景故事...

## 专长领域
1. 专业领域1
2. 专业领域2

## 核心观点
- 观点1
- 观点2
```

### 角色管理功能

#### 1. 上传角色文件
- **批量上传**：支持一次选择多个文件（最多20个）
- **多格式支持**：同时支持.txt、.json、.md格式
- **智能解析**：自动识别文件格式并解析角色信息

#### 2. 编辑角色
- **基本信息编辑**：修改角色名称、系统提示词
- **参数调整**：调整参与积极性和兴趣阈值
- **实时生效**：修改后立即生效

#### 3. 启用/禁用角色
- **状态切换**：可以启用或禁用特定角色
- **灵活控制**：根据需要控制参与讨论的角色

#### 4. 删除角色
- **完全删除**：删除角色及其所有相关数据
- **记忆清理**：自动清理角色的记忆银行文件

### 角色参数说明

#### 参与积极性 (0-1)
- **0.1-0.3**：较低积极性，较少参与讨论
- **0.4-0.6**：中等积极性，适度参与
- **0.7-1.0**：较高积极性，积极参与

#### 兴趣阈值 (0-1)
- **0.1-0.3**：低阈值，容易被话题吸引
- **0.4-0.6**：中等阈值，需要相关话题
- **0.7-1.0**：高阈值，只对高度相关话题感兴趣

## 💬 聊天功能

### 聊天界面
- **消息区域**：显示所有聊天消息
- **输入区域**：发送消息的输入框
- **状态显示**：显示API状态、角色数量等

### 消息特性
- **兴趣度显示**：显示每个角色对当前话题的兴趣度
- **参与原因**：说明角色参与讨论的原因
- **时间戳**：显示消息发送时间
- **角色标识**：清晰显示消息发送者

### 强制参与机制
- **最低参与**：每轮至少2个角色参与讨论
- **智能选择**：优先选择真正感兴趣的角色
- **补充机制**：如果感兴趣角色不足，补充兴趣度最高的
- **透明显示**：显示每个角色的兴趣度和参与原因

### 兴趣度评估标准
- **0.0-0.2**：兴趣很低，不建议参与
- **0.2-0.5**：中等兴趣，可以参与
- **0.5-1.0**：高度兴趣，建议参与

## 🎯 主题管理

### 设置聊天主题
**位置**：侧边栏 → 设置 → 聊天主题

### 主题功能
- **主题设置**：可以设置当前聊天室的主题
- **角色引导**：设置主题后角色会围绕主题展开讨论
- **兴趣影响**：主题会影响角色对话题的兴趣度评估

### 清空聊天记录
**位置**：侧边栏 → 设置 → 聊天管理

### 清空功能
- **完全清空**：删除所有聊天记录
- **重新开始**：清空后可以重新开始对话
- **状态重置**：重置当前话题等状态

## 📊 系统状态

### 状态显示
**位置**：侧边栏 → 设置 → 系统状态

### 状态信息
- **系统状态**：显示系统当前状态（就绪/处理中）
- **API状态**：显示API配置状态（演示模式/已配置/未配置）
- **角色状态**：显示在线角色数量
- **当前话题**：显示当前讨论的话题

### API状态标识
- **演示模式**：橙色标识，表示正在使用演示模式
- **未配置API**：红色标识，提醒用户配置API密钥
- **正常状态**：无特殊标识，表示已配置API

## 🎨 界面功能

### 侧边栏功能
侧边栏包含三个主要标签页：

#### 1. 角色标签页
- **角色列表**：显示所有已上传的角色
- **快速上传**：快速上传角色文件
- **状态查看**：查看角色在线状态和参数

#### 2. 管理标签页
- **角色管理**：完整的角色管理功能
- **文件上传**：支持批量上传角色文件
- **角色编辑**：编辑角色信息和参数

#### 3. 设置标签页
- **主题设置**：设置聊天主题
- **聊天管理**：清空聊天记录
- **API配置**：配置API密钥
- **系统状态**：查看系统状态

### 主聊天区域
- **聊天头部**：显示系统状态和基本信息
- **消息区域**：显示聊天消息和角色回应
- **输入区域**：发送消息的输入框

### 移动端支持
- **响应式设计**：完全支持移动设备
- **侧边栏切换**：点击机器人图标显示/隐藏侧边栏
- **触摸友好**：所有按钮和交互都针对触摸优化

## 🔍 高级功能

### 智能兴趣度评估
系统会根据以下因素评估角色对话题的兴趣度：
- **专业匹配度**：话题与角色专业领域的相关性
- **性格匹配度**：话题与角色性格的匹配程度
- **历史参与**：角色在类似话题上的历史参与度
- **参数设置**：角色的参与积极性和兴趣阈值

### 独立记忆系统
每个角色都有独立的记忆系统：
- **个人记忆银行**：存储角色的重要观点和看法
- **对话历史**：记录角色参与过的对话
- **逻辑一致性**：确保角色发言不与之前的观点矛盾
- **记忆更新**：每次对话后自动更新记忆

### 多模型支持
系统支持多种AI模型：
- **Z.ai模型**：主要推荐的服务
- **OpenAI模型**：备用服务
- **演示模式**：无需API密钥的演示功能
- **智能切换**：主服务失败时自动切换

## 🎯 使用建议

### 1. 新手建议
- **先使用演示模式**：熟悉系统功能
- **上传示例角色**：使用预设角色快速开始
- **尝试简单话题**：从简单话题开始体验
- **观察角色互动**：注意不同角色的回应特点

### 2. 进阶使用
- **配置真实API**：获得更好的AI回应质量
- **创建自定义角色**：根据需要创建专业角色
- **调整角色参数**：优化角色的参与行为
- **设置专业主题**：引导角色进行专业讨论

### 3. 专业使用
- **批量角色管理**：管理大量专业角色
- **复杂话题讨论**：进行深度专业讨论
- **参数精细调整**：精确控制角色行为
- **API优化配置**：配置多个API服务

## 🚨 故障排除

### 常见问题

#### 1. API配置问题
**问题**：API连接失败
**解决**：
- 检查API密钥是否正确
- 确认网络连接正常
- 尝试测试连接功能
- 联系API服务提供商

#### 2. 角色文件问题
**问题**：角色文件上传失败
**解决**：
- 检查文件格式（.txt、.json、.md）
- 确认文件内容格式正确
- 尝试单个文件上传
- 查看错误提示信息

#### 3. 聊天功能问题
**问题**：角色无回应
**解决**：
- 确认有活跃角色
- 检查API配置
- 尝试重启系统
- 查看系统日志

#### 4. 系统性能问题
**问题**：系统响应缓慢
**解决**：
- 减少同时活跃的角色数量
- 检查网络连接
- 清理浏览器缓存
- 重启开发服务器

### 重启系统
如果遇到问题，可以尝试重启系统：
```bash
# 停止当前服务器（Ctrl+C）
# 重新启动
npm run dev
```

### 清理数据
如需清理所有数据：
1. 删除数据库文件：`db/custom.db`
2. 删除记忆银行：`storage/memory_banks/`
3. 重启系统

## 🎉 最佳实践

### 1. 角色创建
- **明确身份**：给角色明确的职业和专业背景
- **丰富性格**：描述角色的性格特点和行为习惯
- **专业领域**：定义角色的专业知识和技能范围
- **语言风格**：设定角色的说话方式和语言特点

### 2. 话题引导
- **具体明确**：使用具体而非笼统的话题
- **专业相关**：选择与角色专业相关的话题
- **循序渐进**：从简单话题逐步深入
- **多角度讨论**：鼓励不同角度的观点交流

### 3. 系统配置
- **API优先**：优先配置Z.ai API获得最佳体验
- **参数优化**：根据需要调整角色参数
- **定期维护**：定期检查和更新角色配置
- **备份重要**：定期备份重要的角色文件

---

## 📞 技术支持

如果在使用过程中遇到问题，请：

1. **查看本指南**：大多数问题都能在指南中找到解决方案
2. **检查系统日志**：查看控制台输出或`dev.log`文件
3. **重启系统**：很多问题可以通过重启系统解决
4. **重新配置**：尝试重新配置API密钥和角色文件

**享受您的AI角色聊天体验！** 🎭