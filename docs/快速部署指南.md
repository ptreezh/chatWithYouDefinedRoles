# ğŸš€ Chat4 å¿«é€Ÿéƒ¨ç½²æŒ‡å—

## ğŸ“‹ ä¸€é”®éƒ¨ç½²

### æœ€ç®€å•çš„æ–¹å¼
```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd Chat4

# 2. è¿è¡Œè‡ªåŠ¨åŒ–éƒ¨ç½²
npm run deploy

# 3. æŒ‰ç…§æç¤ºé€‰æ‹©é…ç½®
# 4. ç­‰å¾…éƒ¨ç½²å®Œæˆ
```

## ğŸ› ï¸ æ‰‹åŠ¨éƒ¨ç½²

### æ–¹å¼1: æœ¬åœ°éƒ¨ç½² (æœ€å¿«)

```bash
# 1. å¯åŠ¨Ollama (å¦‚æœä½¿ç”¨æœ¬åœ°æ¨¡å‹)
ollama serve

# 2. å®‰è£…ä¾èµ–
npm install

# 3. æ„å»ºåº”ç”¨
npm run build
npm run db:generate

# 4. å¯åŠ¨åº”ç”¨
npm start

# 5. è®¿é—®
http://localhost:3000
```

### æ–¹å¼2: PM2éƒ¨ç½² (æ¨èç”Ÿäº§ç¯å¢ƒ)

```bash
# 1. å®‰è£…PM2
npm install -g pm2

# 2. å®‰è£…ä¾èµ–å¹¶æ„å»º
npm install
npm run build
npm run db:generate

# 3. å¯åŠ¨åº”ç”¨
pm2 start "npm start" --name chat4

# 4. æŸ¥çœ‹çŠ¶æ€
pm2 status

# 5. æŸ¥çœ‹æ—¥å¿—
pm2 logs chat4
```

### æ–¹å¼3: Dockeréƒ¨ç½² (æœ€ç¨³å®š)

```bash
# 1. æ„å»ºå¹¶å¯åŠ¨
docker-compose up -d --build

# 2. æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# 3. è®¿é—®
http://localhost:3000
```

### æ–¹å¼4: Verceléƒ¨ç½² (æœ€ç®€å•)

```bash
# 1. å®‰è£…Vercel CLI
npm install -g vercel

# 2. ç™»å½•
vercel login

# 3. éƒ¨ç½²
vercel --prod
```

## ğŸ”§ é…ç½®é€‰é¡¹

### ç¯å¢ƒå˜é‡
åˆ›å»º `.env` æ–‡ä»¶ï¼š
```bash
NODE_ENV=production
PORT=3000
DATABASE_URL=file:./db/custom.db

# AIæœåŠ¡é…ç½® (ä¸‰é€‰ä¸€)
# Ollama (æœ¬åœ°æ¨¡å‹)
OLLAMA_BASE_URL=http://localhost:11434
OLLAMA_MODEL=llama2

# Z.ai (äº‘æœåŠ¡)
ZAI_API_KEY=your_zai_key

# OpenAI (äº‘æœåŠ¡)
OPENAI_API_KEY=your_openai_key
```

### éƒ¨ç½²é…ç½®
åˆ›å»º `deploy.config.json` æ–‡ä»¶ï¼š
```json
{
  "deployment": {
    "type": "pm2", // local, pm2, docker, vercel
    "domain": "your-domain.com",
    "ssl": true,
    "ollama": true
  },
  "database": {
    "type": "sqlite", // sqlite, postgresql, mysql
    "url": "file:./db/custom.db"
  },
  "ai": {
    "provider": "ollama", // ollama, zai, openai
    "model": "llama2",
    "apiKey": ""
  }
}
```

## ğŸ¯ æ¨èéƒ¨ç½²æ–¹æ¡ˆ

### å¼€å‘/æµ‹è¯•ç¯å¢ƒ
**æ¨è**: æœ¬åœ°éƒ¨ç½²
```bash
npm run dev
```

### å°å‹ç”Ÿäº§ç¯å¢ƒ
**æ¨è**: PM2éƒ¨ç½²
```bash
npm run deploy:pm2
```

### ä¸­å‹ç”Ÿäº§ç¯å¢ƒ
**æ¨è**: Dockeréƒ¨ç½²
```bash
npm run deploy:docker
```

### å¤§å‹ç”Ÿäº§ç¯å¢ƒ
**æ¨è**: Kubernetes + Docker
```bash
# å‚è€ƒå®Œæ•´çš„éƒ¨ç½²æŒ‡å—
```

### äº‘å¹³å°éƒ¨ç½²
**æ¨è**: Verceléƒ¨ç½²
```bash
npm run deploy:vercel
```

## ğŸ“Š éƒ¨ç½²åéªŒè¯

### 1. å¥åº·æ£€æŸ¥
```bash
curl http://localhost:3000/api/health
```

### 2. åŸºç¡€æµ‹è¯•
```bash
npm run test:basic
```

### 3. åŠŸèƒ½æµ‹è¯•
```bash
npm run test:e2e
```

### 4. æ€§èƒ½æµ‹è¯•
```bash
npm run test:performance
```

## ğŸ”§ å¸¸è§é—®é¢˜

### 1. ç«¯å£å†²çª
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -an | grep :3000

# æ›´æ”¹ç«¯å£
export PORT=3001
npm start
```

### 2. Ollamaè¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥OllamaæœåŠ¡
curl http://localhost:11434/api/tags

# é‡å¯Ollama
# Windows: é‡å¯Ollamaåº”ç”¨
# Linux/Mac: sudo systemctl restart ollama
```

### 3. æ•°æ®åº“é—®é¢˜
```bash
# é‡æ–°ç”Ÿæˆæ•°æ®åº“
npm run db:generate

# é‡ç½®æ•°æ®åº“
npm run db:reset
```

### 4. å†…å­˜ä¸è¶³
```bash
# å¢åŠ Node.jså†…å­˜
export NODE_OPTIONS="--max-old-space-size=4096"
npm start
```

## ğŸ“ˆ ç›‘æ§å’Œç»´æŠ¤

### PM2ç›‘æ§
```bash
# å®æ—¶ç›‘æ§
pm2 monit

# æŸ¥çœ‹èµ„æºä½¿ç”¨
pm2 info chat4

# é‡å¯ç­–ç•¥
pm2 describe chat4
```

### æ—¥å¿—ç®¡ç†
```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
pm2 logs chat4

# æ—¥å¿—è½®è½¬
pm2 install pm2-logrotate

# æ¸…ç†æ—¥å¿—
pm2 flush
```

### å¤‡ä»½ç­–ç•¥
```bash
# æ•°æ®åº“å¤‡ä»½
cp db/custom.db backup/custom_$(date +%Y%m%d).db

# æ–‡ä»¶å¤‡ä»½
tar -czf backup/storage_$(date +%Y%m%d).tar.gz storage/
```

## ğŸš€ é«˜çº§éƒ¨ç½²

### è´Ÿè½½å‡è¡¡
```nginx
upstream chat4_backend {
    server 127.0.0.1:3000;
    server 127.0.0.1:3001;
    server 127.0.0.1:3002;
}

server {
    listen 80;
    server_name your-domain.com;
    
    location / {
        proxy_pass http://chat4_backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

### SSLé…ç½®
```bash
# ä½¿ç”¨Let's Encrypt
sudo certbot --nginx -d your-domain.com

# è‡ªåŠ¨ç»­æœŸ
crontab -e
# æ·»åŠ : 0 12 * * * /usr/bin/certbot renew --quiet
```

### é›†ç¾¤éƒ¨ç½²
```bash
# PM2é›†ç¾¤æ¨¡å¼
pm2 start server.js -i max

# æˆ–æŒ‡å®šå®ä¾‹æ•°
pm2 start server.js -i 4
```

---

## ğŸ‰ æ€»ç»“

Chat4æ”¯æŒå¤šç§éƒ¨ç½²æ–¹å¼ï¼Œä»ç®€å•çš„æœ¬åœ°éƒ¨ç½²åˆ°å¤æ‚çš„ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ï¼š

1. **å¿«é€Ÿå¼€å§‹**: `npm run deploy` ä¸€é”®éƒ¨ç½²
2. **æœ¬åœ°æµ‹è¯•**: `npm start` æœ¬åœ°è¿è¡Œ
3. **ç”Ÿäº§ç¯å¢ƒ**: PM2/Docker/Vercel éƒ¨ç½²
4. **ä¼ä¸šçº§**: Kubernetes + è´Ÿè½½å‡è¡¡

é€‰æ‹©æœ€é€‚åˆä½ éœ€æ±‚çš„éƒ¨ç½²æ–¹å¼ï¼ŒæŒ‰ç…§ç›¸åº”æ­¥éª¤è¿›è¡Œé…ç½®å’Œéƒ¨ç½²ï¼